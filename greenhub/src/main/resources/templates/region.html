<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>제철 특산품 - GreenHub</title>
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/region.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
<!-- 헤더 include -->
<div th:replace="common/header :: header"></div>

<!-- 메인 컨텐츠 -->
<main class="main-content">
    <!-- 배너 섹션 -->
    <section class="banner-section">
        <div class="banner-content">
            <div class="banner-title">
                <img src="/images/과일 트럭.png" alt="지역 특산품" class="banner-icon">
                <p class="title-underground">___________</p>
                <div class="title-name">지역 특산품</div>
            </div>

            <section class="search-section">
                <div class="search-container">
                    <div class="search-bar">
                        <input type="text" id="searchInput" placeholder="검색어를 입력하세요" class="search-input">
                        <button class="search-btn">
                            <img src="/images/돋보기 아이콘.png" alt="검색" class="search-icon">
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </section>

    <section class="content">
        <!-- 컨텐츠 영역 -->
        <div class="content-wrapper">
            <!-- 카테고리 필터 -->
            <section class="category-filter-section">
                <div class="category-filter-container">
                    <h3 class="filter-title">상품 카테고리</h3>
                    <div class="category-buttons">
                        <button class="category-btn active" data-category="all"><span>전체</span></button>
                        <button class="category-btn" data-category="농산물"><span>농산물</span></button>
                        <button class="category-btn" data-category="축산물"><span>축산물</span></button>
                        <button class="category-btn" data-category="수산물"><span>수산물</span></button>
                        <button class="category-btn" data-category="가공식품"><span>가공식품</span></button>
                    </div>
                </div>
            </section>

            <!-- 상품 목록 -->
            <section class="products-section" id="productsSection">
                <div th:each="product : ${products}"
                     class="product-card"
                     th:attr="data-region=${product.regionText},
                              data-product-id=${product.productId},
                              data-category=${product.productType}"
                     th:onclick="|location.href='@{/region-detail(id=${product.productId}, region=${product.regionText})}'|"
                     style="cursor: pointer;">

                    <div class="product-image">
                        <img
                                th:alt="${product.productName}"
                                th:src="@{/api/products/{id}/thumbnail(id=${product.productId})}"
                                th:onerror="|this.onerror=null;this.src='@{/images/따봉 트럭.png}'|"
                                style="width: 100%; height: 200px; object-fit: cover;">
                        <p class="product-place" th:text="${product.regionText}"></p>
                    </div>

                    <div class="product-content">
                        <h3 class="product-title" th:text="${product.productName}"></h3>
                        <div class="product-info">
                            <div class="title-info">
                                <p class="product-description" th:text="${product.description}"></p>
                            </div>
                            <div class="product-prices" th:data-product-type="${product.productType}">
                                <!-- 가격이 JS로 동적 생성 -->
                            </div>
                        </div>
                    </div>

                    <div class="company-info">
                        <h4>업체 문의</h4>
                        <p th:text="${product.companyPhone ?: '053-555-444'}">053-555-444</p>
                        <p th:text="${product.companyEmail ?: 'monkyeon@naver.com'}">monkyeon@naver.com</p>
                        <p th:text="${product.companyName ?: '문경이좋아'}">문경이좋아</p>
                    </div>

                </div>
            </section>

            <!-- 페이징 UI -->
            <div class="pagination-container" id="paginationContainer">
                <!-- JavaScript에서 동적으로 생성 -->
            </div>
        </div>

        <!-- 지도 섹션 -->
        <aside class="map-section">
            <div class="map-wrap">
                <img src="/images/svg/한국 지도.svg" alt="한국 지도" class="korea-map" id="koreaMap">
                <div class="region-labels">
                    <span class="region-label seoul-label" data-region="seoul">서울</span>
                    <span class="region-label gyeonggi-label" data-region="gyeonggi">경기도</span>
                    <span class="region-label incheon-label" data-region="incheon">인천</span>
                    <span class="region-label gangwon-label" data-region="gangwon">강원도</span>
                    <span class="region-label chungbuk-label" data-region="chungbuk">충북</span>
                    <span class="region-label chungnam-label" data-region="chungnam">충남</span>
                    <span class="region-label daejeon-label" data-region="daejeon">대전</span>
                    <span class="region-label jeonbuk-label" data-region="jeonbuk">전북</span>
                    <span class="region-label jeonnam-label" data-region="jeonnam">전남</span>
                    <span class="region-label gwangju-label" data-region="gwangju">광주</span>
                    <span class="region-label gyeongbuk-label" data-region="gyeongbuk">경북</span>
                    <span class="region-label gyeongnam-label" data-region="gyeongnam">경남</span>
                    <span class="region-label daegu-label" data-region="daegu">대구</span>
                    <span class="region-label busan-label" data-region="busan">부산</span>
                    <span class="region-label ulsan-label" data-region="ulsan">울산</span>
                    <span class="region-label jeju-label" data-region="jeju">제주</span>
                </div>
            </div>

            <!-- 선택된 지역 표시 섹션 -->
            <section class="selected-region-section" id="selectedRegionSection" style="display: none;">
                <div class="selected-region-container">
                    <div class="selected-region-info">
                        <span class="selected-label">선택된 지역:</span>
                        <span class="selected-region-name" id="selectedRegionName"></span>
                    </div>
                    <button class="clear-selection-btn" id="clearSelectionBtn">
                        <span class="clear-icon">✕</span>
                    </button>
                </div>
            </section>
        </aside>
    </section>
</main>

<!-- 서버 사이드 페이징 UI -->
<div class="pagination-container" th:if="${totalPages > 1}">
    <div class="pagination-info">
        <span th:text="'총 ' + ${totalElements} + '개 상품 (' + ${currentPage + 1} + '/' + ${totalPages} + ' 페이지)'"></span>
    </div>
    <div class="pagination">
        <!-- 이전 버튼 -->
        <a th:if="${currentPage > 0}" 
           th:href="@{/region(page=${currentPage - 1}, size=${pageSize}, type=${selectedType}, region=${selectedRegion}, search=${searchTerm})}"
           class="page-btn prev-btn">
            <span>← 이전</span>
        </a>
        <span th:unless="${currentPage > 0}" class="page-btn prev-btn disabled">
            <span>← 이전</span>
        </span>
        
        <!-- 페이지 번호들 -->
        <div class="page-numbers">
            <a th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}"
               th:if="${pageNum >= currentPage - 2 and pageNum <= currentPage + 2}"
               th:href="@{/region(page=${pageNum}, size=${pageSize}, type=${selectedType}, region=${selectedRegion}, search=${searchTerm})}"
               th:text="${pageNum + 1}"
               th:class="${pageNum == currentPage} ? 'page-number active' : 'page-number'"></a>
        </div>
        
        <!-- 다음 버튼 -->
        <a th:if="${currentPage < totalPages - 1}" 
           th:href="@{/region(page=${currentPage + 1}, size=${pageSize}, type=${selectedType}, region=${selectedRegion}, search=${searchTerm})}"
           class="page-btn next-btn">
            <span>다음 →</span>
        </a>
        <span th:unless="${currentPage < totalPages - 1}" class="page-btn next-btn disabled">
            <span>다음 →</span>
        </span>
    </div>
</div>

<!-- 푸터 include -->
<div th:replace="common/footer :: footer"></div>
<script src="/js/region.js"></script>
<script src="/js/main.js"></script>
</body>
</html>
