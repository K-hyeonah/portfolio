<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ë³´ìˆ˜ì • - GreenHub</title>
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <link rel="stylesheet" th:href="@{/css/profile-edit.css}">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* ê°„ë‹¨ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:1000}
        .modal{background:#fff;border-radius:12px;max-width:460px;width:90%;padding:20px;box-shadow:0 12px 30px rgba(0,0,0,.25)}
        .modal h3{margin:0 0 6px;font-size:20px}
        .modal p{margin:8px 0 12px;color:#555;line-height:1.5}
        .modal textarea{width:100%;min-height:90px;border:1px solid #ddd;border-radius:8px;padding:10px;resize:vertical}
        .modal .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:14px}
        .btn-danger{background:#e74c3c;color:#fff;border:none;border-radius:8px;padding:10px 14px;cursor:pointer;font-weight:600}
        .btn-outline{background:#fff;border:1px solid #ccc;border-radius:8px;padding:10px 14px;cursor:pointer}
        .danger-zone{margin-top:24px;border-top:1px dashed #eee;padding-top:18px}
        .danger-zone .delete-btn{width:100%;background:#e53935;color:#fff;border:none;border-radius:10px;padding:12px 16px;font-weight:700;cursor:pointer}
        .danger-zone .desc{color:#777;margin:8px 0 0}
        .muted{color:#777;font-size:12px}
    </style>
</head>
<body>
<!-- í—¤ë” include -->
<div th:replace="~{common/header :: header}"></div>

<div class="profile-edit-container"
     th:data-is-company="${currentCompany != null}"
     th:data-logout-url="@{/logout}"
     th:data-delete-url="${currentCompany != null} ? @{/company/account/delete} : @{/account/delete}">
    <div class="profile-edit-card">
        <!-- í”„ë¡œí•„ ì‚¬ì§„ -->
        <div class="profile-picture-section">
            <div class="profile-picture">
                <div class="profile-placeholder">
                    <span class="profile-icon">ğŸ‘¤</span>
                </div>
                <div class="camera-icon"><span>ğŸ“·</span></div>
            </div>
        </div>

        <!-- ì •ë³´ìˆ˜ì • í¼ -->
        <form class="profile-edit-form" id="profileEditForm">

            <!-- ===== ê°œì¸ íšŒì› ì „ìš© ===== -->
            <div th:if="${currentUser != null}">
                <!-- ì´ë¦„ -->
                <div class="form-group">
                    <label class="form-label" for="name">ì´ë¦„</label>
                    <input type="text"
                           id="name"
                           class="form-input"
                           placeholder="ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                           th:value="${currentUser.name}"
                           required>
                </div>

                <!-- ì•„ì´ë””(loginId) -->
                <div class="form-group">
                    <label class="form-label" for="userId">ì•„ì´ë””</label>
                    <input type="text"
                           id="userId"
                           class="form-input"
                           th:value="${currentUser.loginId}"
                           readonly disabled>
                </div>

                <!-- ë¹„ë°€ë²ˆí˜¸(ìƒˆ ë¹„ë²ˆ) : ì„ íƒ ì…ë ¥ -->
                <div class="form-group">
                    <label class="form-label" for="password">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password"
                           id="password"
                           class="form-input"
                           placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”">
                    <div class="muted">* ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹œì—ë§Œ ì…ë ¥í•˜ì„¸ìš”. (8ì ì´ìƒ, ì˜ë¬¸+ìˆ«ì í¬í•¨)</div>
                </div>

                <!-- ì´ë©”ì¼ -->
                <div class="form-group">
                    <label class="form-label" for="email">ì´ë©”ì¼</label>
                    <input type="email"
                           id="email"
                           class="form-input"
                           th:value="${currentUser.email}"
                           readonly disabled>
                </div>
            </div>

            <!-- ===== ì—…ì²´ ì „ìš© ===== -->
            <div th:if="${currentCompany != null}">
                <!-- ë‹´ë‹¹ìëª…(í™”ë©´ì—ì„œëŠ” ì´ë¦„) -->
                <div class="form-group">
                    <label class="form-label" for="name">ì´ë¦„</label>
                    <input type="text"
                           id="name"
                           class="form-input"
                           placeholder="ë‹´ë‹¹ìëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                           th:value="${currentCompany.managerName}"
                           required>
                    <div class="muted">* ì—…ì²´ì˜ ê²½ìš° â€˜ë‹´ë‹¹ìëª…â€™ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.</div>
                </div>

                <!-- ì•„ì´ë””(loginId) -->
                <div class="form-group">
                    <label class="form-label" for="userId">ì•„ì´ë””</label>
                    <input type="text"
                           id="userId"
                           class="form-input"
                           th:value="${currentCompany.loginId}"
                           readonly disabled>
                </div>

                <!-- ë¹„ë°€ë²ˆí˜¸(ìƒˆ ë¹„ë²ˆ) : ì„ íƒ ì…ë ¥ -->
                <div class="form-group">
                    <label class="form-label" for="password">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password"
                           id="password"
                           class="form-input"
                           placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”">
                    <div class="muted">* ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹œì—ë§Œ ì…ë ¥í•˜ì„¸ìš”. (8ì ì´ìƒ, ì˜ë¬¸+ìˆ«ì í¬í•¨)</div>
                </div>

                <!-- ì´ë©”ì¼ -->
                <div class="form-group">
                    <label class="form-label" for="email">ì´ë©”ì¼</label>
                    <input type="email"
                           id="email"
                           class="form-input"
                           th:value="${currentCompany.email}"
                           readonly disabled>
                </div>
            </div>

            <!-- ìœ„ì¹˜(ì„ íƒ) : ê³µí†µ í™”ë©´ ì˜µì…˜ -->
            <div class="form-group">
                <label class="form-label">ìœ„ì¹˜</label>
                <div class="location-inputs">
                    <select class="form-select" id="city">
                        <option value="">ì‹œ/ë„ ì„ íƒ</option>
                        <option value="ì„œìš¸">ì„œìš¸íŠ¹ë³„ì‹œ</option>
                        <option value="ë¶€ì‚°">ë¶€ì‚°ê´‘ì—­ì‹œ</option>
                        <option value="ëŒ€êµ¬">ëŒ€êµ¬ê´‘ì—­ì‹œ</option>
                        <option value="ì¸ì²œ">ì¸ì²œê´‘ì—­ì‹œ</option>
                        <option value="ê´‘ì£¼">ê´‘ì£¼ê´‘ì—­ì‹œ</option>
                        <option value="ëŒ€ì „">ëŒ€ì „ê´‘ì—­ì‹œ</option>
                        <option value="ìš¸ì‚°">ìš¸ì‚°ê´‘ì—­ì‹œ</option>
                        <option value="ì„¸ì¢…">ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ</option>
                        <option value="ê²½ê¸°">ê²½ê¸°ë„</option>
                        <option value="ê°•ì›">ê°•ì›ë„</option>
                        <option value="ì¶©ë¶">ì¶©ì²­ë¶ë„</option>
                        <option value="ì¶©ë‚¨">ì¶©ì²­ë‚¨ë„</option>
                        <option value="ì „ë¶">ì „ë¼ë¶ë„</option>
                        <option value="ì „ë‚¨">ì „ë¼ë‚¨ë„</option>
                        <option value="ê²½ë¶">ê²½ìƒë¶ë„</option>
                        <option value="ê²½ë‚¨">ê²½ìƒë‚¨ë„</option>
                        <option value="ì œì£¼">ì œì£¼íŠ¹ë³„ìì¹˜ë„</option>
                    </select>
                    <select class="form-select" id="district">
                        <option value="">ë™ ì„ íƒ</option>
                    </select>
                    <input type="text" id="detailAddress" class="form-input" placeholder="ìƒì„¸ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”">
                </div>
            </div>

            <button type="submit" class="save-btn">
                <span class="check-icon">âœ“</span>
                ë³€ê²½ ì‚¬í•­ ì €ì¥
            </button>
        </form>

        <!-- ìœ„í—˜ êµ¬ì—­: íƒˆí‡´ -->
        <div class="danger-zone">
            <h3>íƒˆí‡´í•˜ê¸°</h3>
            <p class="desc">ê³„ì •ì„ ì˜êµ¬ ì‚­ì œí•©ë‹ˆë‹¤. ì£¼ë¬¸/ë¦¬ë·° ë“± ì¼ë¶€ ê¸°ë¡ì€ ë²•ì •ë³´ê´€ ì‚¬ìœ ë¡œ ì¼ì • ê¸°ê°„ ë³´ê´€ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <button type="button" class="delete-btn" id="openDeleteModalBtn">ê³„ì • íƒˆí‡´</button>
        </div>
    </div>
</div>

<!-- íƒˆí‡´ ëª¨ë‹¬ -->
<div class="modal-backdrop" id="deleteModal">
    <div class="modal">
        <h3>ì •ë§ íƒˆí‡´í•˜ì‹œê² ì–´ìš”?</h3>
        <p>íƒˆí‡´ ì‚¬ìœ ë¥¼ ê°„ë‹¨íˆ ì ì–´ì£¼ì„¸ìš”. ë” ë‚˜ì€ ì„œë¹„ìŠ¤ ê°œì„ ì— ë„ì›€ì´ ë©ë‹ˆë‹¤.</p>
        <textarea id="deleteReason" placeholder="ì˜ˆ) ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ, ì¤‘ë³µ ê³„ì • ë“±"></textarea>
        <label style="display:flex;align-items:center;gap:8px;margin-top:10px;">
            <input type="checkbox" id="deleteAcknowledge">
            <span>íƒˆí‡´ ì‹œ ê³„ì • ë° ì¼ë¶€ ë°ì´í„°ê°€ ì‚­ì œ(ë˜ëŠ” ë¹„ì‹ë³„í™”)ë¨ì„ ì´í•´í–ˆìŠµë‹ˆë‹¤.</span>
        </label>
        <div class="actions">
            <button class="btn-outline" id="cancelDeleteBtn">ì·¨ì†Œ</button>
            <button class="btn-danger" id="confirmDeleteBtn">ì˜êµ¬ íƒˆí‡´</button>
        </div>
        <div class="muted" style="margin-top:6px">â€» ì§„í–‰ ì¤‘ì¸ ì£¼ë¬¸/ì •ì‚°ì´ ìˆì„ ê²½ìš° íƒˆí‡´ê°€ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
    </div>
</div>

<!-- í‘¸í„° include -->
<div th:replace="~{common/footer :: footer}"></div>

<script th:src="@{/js/profile-edit.js}"></script>
<script>
    // ê°„ë‹¨ ëª¨ë‹¬ ë™ì‘ (í•„ìš” ì‹œ)
    const openBtn = document.getElementById('openDeleteModalBtn');
    const modal = document.getElementById('deleteModal');
    const cancelBtn = document.getElementById('cancelDeleteBtn');
    const confirmBtn = document.getElementById('confirmDeleteBtn');
    const ack = document.getElementById('deleteAcknowledge');

    if (openBtn && modal) {
        openBtn.addEventListener('click', () => { modal.style.display = 'flex'; });
    }
    if (cancelBtn && modal) {
        cancelBtn.addEventListener('click', () => { modal.style.display = 'none'; });
    }
    if (confirmBtn) {
        confirmBtn.addEventListener('click', () => {
            if (!ack.checked) { alert('ì•ˆë‚´ ì‚¬í•­ì— ë™ì˜í•´ì£¼ì„¸ìš”.'); return; }
            const isCompany = document.querySelector('.profile-edit-container').dataset.isCompany === 'true';
            const url = isCompany ? '/company/account/delete' : '/account/delete';
            // í¼ POSTë¡œ ì „ì†¡
            const f = document.createElement('form');
            f.method = 'POST';
            f.action = url;
            document.body.appendChild(f);
            f.submit();
        });
    }
</script>
</body>
</html>
